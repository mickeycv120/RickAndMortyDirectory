<div class="mx-5">
  @if (data$ | async; as data) {
  <!-- Loading skeleton - más compacto -->
  @if (data.isLoading && data.characters.length === 0) {
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-6">
    @for (item of [1, 2, 3]; track item) {
    <div class="p-6 rounded-xl border bg-background text-center">
      <div class="w-full h-72 bg-gray-200 rounded-lg mb-6 animate-pulse"></div>
      <div class="h-4 bg-gray-200 rounded mb-3 animate-pulse"></div>
      <div class="h-3 bg-gray-100 rounded w-2/3 mx-auto animate-pulse"></div>
    </div>
    }
  </div>
  }

  <!-- Lista de personajes - siempre visible si hay datos -->
  @if (data.characters.length > 0) {
  <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-8 mt-6">
    @for (character of data.characters; track trackByCharacter($index, character)) {
    <div
      class="p-6 rounded-xl border bg-background border-blue-950 text-center cursor-pointer hover:shadow-lg transition-all duration-200 hover:scale-105 relative"
      (click)="onCharacterClick(character)"
    >
      <!-- Botón de favorito -->
      <button
        class="absolute top-4 right-4 p-2 rounded-full transition-all duration-200 z-20"
        [class]="
          character.isFavorite
            ? 'bg-red-500 text-white hover:bg-red-600'
            : 'bg-gray-700/80 text-gray-300 hover:bg-gray-600'
        "
        (click)="onFavoriteClick(character, $event)"
      >
        <svg
          width="20"
          height="20"
          viewBox="0 0 24 24"
          [attr.fill]="character.isFavorite ? 'currentColor' : 'none'"
          stroke="currentColor"
          stroke-width="2"
          stroke-linecap="round"
          stroke-linejoin="round"
        >
          <path
            d="M20.84 4.61a5.5 5.5 0 0 0-7.78 0L12 5.67l-1.06-1.06a5.5 5.5 0 0 0-7.78 7.78l1.06 1.06L12 21.23l7.78-7.78 1.06-1.06a5.5 5.5 0 0 0 0-7.78z"
          ></path>
        </svg>
      </button>

      <div class="relative">
        <img
          [src]="character.image"
          [alt]="character.name"
          class="w-full h-[280px] object-cover rounded-lg mb-6 mx-auto transition-opacity duration-300"
          loading="lazy"
        />
      </div>
      <h3 class="text-xl font-semibold mb-2">{{ character.name }}</h3>
      <p class="text-base text-muted-foreground">
        {{ character.status }} - {{ character.species }}
      </p>
    </div>
    }
  </div>
  }<!-- Loading indicator sutil cuando se están cargando más datos -->
  @if (data.isLoading && data.characters.length > 0) {
  <div class="text-center py-4">
    <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
    <span class="ml-2 text-muted-foreground">Cargando...</span>
  </div>
  }

  <!-- Mensaje cuando no hay resultados -->
  @if (!data.isLoading && data.characters.length === 0) {
  <div class="text-center py-8">
    <p class="text-muted-foreground">No se encontraron personajes</p>
  </div>
  }

  <!-- Paginación -->
  @if (!data.isLoading && data.characters.length > 0) {
  <div class="flex justify-between items-center mt-12 mb-4 px-4">
    <button
      (click)="prevPage()"
      [disabled]="(currentPage$ | async) === 1"
      class="px-6 py-3 bg-green-600 text-white rounded-lg disabled:opacity-50 hover:bg-green-700 transition-colors flex items-center justify-center"
    >
      Anterior
    </button>

    <span class="text-lg font-medium">Página {{ currentPage$ | async }}</span>

    <button
      (click)="nextPage()"
      class="px-6 py-3 bg-green-600 text-white rounded-lg hover:bg-green-700 transition-colors flex items-center justify-center"
    >
      Siguiente
    </button>
  </div>
  } }
</div>
