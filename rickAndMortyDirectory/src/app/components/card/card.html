<ng-container *ngIf="data$ | async as data">
  <!-- Loading skeleton - más compacto -->
  <div
    *ngIf="data.isLoading && data.characters.length === 0"
    class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6"
  >
    <div *ngFor="let item of [1, 2, 3]" class="p-4 rounded-xl border bg-background text-center">
      <div class="w-full h-32 bg-gray-200 rounded-lg mb-3 animate-pulse"></div>
      <div class="h-3 bg-gray-200 rounded mb-2 animate-pulse"></div>
      <div class="h-2 bg-gray-100 rounded w-2/3 mx-auto animate-pulse"></div>
    </div>
  </div>

  <!-- Lista de personajes - siempre visible si hay datos -->
  <div *ngIf="data.characters.length > 0" class="grid grid-cols-1 md:grid-cols-3 gap-6 mt-6">
    <div
      *ngFor="let character of data.characters; trackBy: trackByCharacter"
      class="p-4 rounded-xl border bg-background text-center"
    >
      <div class="relative">
        <img
          [src]="character.image"
          [alt]="character.name"
          class="rounded-lg mb-4 mx-auto transition-opacity duration-300"
          loading="lazy"
          style="width: 100%; height: 200px; object-fit: cover"
        />
      </div>
      <h3 class="text-lg font-semibold">{{ character.name }}</h3>
      <p class="text-sm text-muted-foreground">{{ character.status }} - {{ character.species }}</p>
    </div>
  </div>

  <!-- Loading indicator sutil cuando se están cargando más datos -->
  <div *ngIf="data.isLoading && data.characters.length > 0" class="text-center py-4">
    <div class="inline-block animate-spin rounded-full h-6 w-6 border-b-2 border-primary"></div>
    <span class="ml-2 text-muted-foreground">Cargando...</span>
  </div>

  <!-- Mensaje cuando no hay resultados -->
  <div *ngIf="!data.isLoading && data.characters.length === 0" class="text-center py-8">
    <p class="text-muted-foreground">No se encontraron personajes</p>
  </div>

  <!-- Paginación -->
  <div *ngIf="!data.isLoading && data.characters.length > 0" class="flex justify-between mt-6">
    <button
      (click)="prevPage()"
      [disabled]="(currentPage$ | async) === 1"
      class="px-4 py-2 bg-gray-200 rounded disabled:opacity-50"
    >
      Anterior
    </button>

    <span>Página {{ currentPage$ | async }}</span>

    <button (click)="nextPage()" class="px-4 py-2 bg-gray-200 rounded">Siguiente</button>
  </div>
</ng-container>
